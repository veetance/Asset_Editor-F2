<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ASSET EDITOR</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@200..900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/animations.css">
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
</head>

<body>
  <!-- Splash Screen - Logo Only -->
  <div id="splash" class="splash">
    <div class="splash-logo-animated">
      <div class="splash-layer">
        <svg viewBox="0 0 60 20" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M30 2L5 10L30 18L55 10L30 2Z" />
        </svg>
      </div>
      <div class="splash-layer">
        <svg viewBox="0 0 60 20" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M30 2L5 10L30 18L55 10L30 2Z" />
        </svg>
      </div>
      <div class="splash-layer">
        <svg viewBox="0 0 60 20" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M30 2L5 10L30 18L55 10L30 2Z" />
        </svg>
      </div>
      <div class="splash-layer">
        <svg viewBox="0 0 60 20" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M30 2L5 10L30 18L55 10L30 2Z" />
        </svg>
      </div>
    </div>
  </div>

  <!-- Global Loading Bar (Top of viewport) -->
  <div id="globalLoadingBar" class="global-loading-bar"></div>

  <div class="app" data-mode="generate">
    <header class="header">
      <div class="logo">
        <svg viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M16 2L2 9L16 16L30 9L16 2Z" fill="currentColor" stroke="none" />
          <path d="M2 16L16 23L30 16" stroke-linecap="round" stroke-linejoin="round" />
          <path d="M2 23L16 30L30 23" stroke-linecap="round" stroke-linejoin="round" opacity="0.5" />
        </svg>
        ASSET EDITOR
      </div>
      <div class="model-picker" id="modelPicker">
        <!-- Loading Bar pins to the top of this square section -->
        <div id="headerLoadingBar" class="header-loading-bar"></div>
        <div class="picker-trigger" id="pickerTrigger">
          <span id="currentModelName">Model</span>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="12" height="12">
            <path d="m6 9 6 6 6-6" />
          </svg>
        </div>
        <div class="picker-dropdown" id="pickerDropdown">
          <div class="picker-dropdown-inner">
            <div class="picker-item" data-model="flux-4b">
              <span class="model-name">FLUX Klein 4B</span>
              <button class="btn-picker" data-model="flux-4b">LOAD</button>
            </div>
            <div class="picker-item" data-model="flux-9b">
              <span class="model-name">FLUX Klein 9B (Safetensors)</span>
              <button class="btn-picker" data-model="flux-9b">LOAD</button>
            </div>
            <div class="picker-item" data-model="qwen">
              <span class="model-name">Qwen-Image-Layered</span>
              <button class="btn-picker" data-model="qwen">LOAD</button>
            </div>
          </div>
        </div>
      </div>
      <div id="telemetryStack" class="telemetry-stack">
        <!-- VRAM Bar (Top, Purple, Interactive) -->
        <div class="telemetry-row vram-row" id="vramGovernor">
          <div class="telemetry-inner" id="vramProgress">
            <span class="telemetry-label">GPU <span class="label-muted" id="totalVramLabel">16GB</span>:</span>
            <span class="telemetry-value" id="vramValue">8GB</span>
            <div class="governor-handle">â†”</div>
          </div>
        </div>
        <!-- CPU Bar (Middle, Green) -->
        <div class="telemetry-row cpu-row">
          <div class="telemetry-inner" id="cpuProgress">
            <span class="telemetry-label">CPU <span class="label-muted">LOAD</span>:</span>
            <span class="telemetry-value" id="cpuValue">0%</span>
          </div>
        </div>
        <!-- RAM Bar (Bottom, Pink) -->
        <div class="telemetry-row ram-row">
          <div class="telemetry-inner" id="ramProgress">
            <span class="telemetry-label">RAM <span class="label-muted" id="totalRamLabel">64GB</span>:</span>
            <span class="telemetry-value" id="ramValue">0GB</span>
          </div>
        </div>
      </div>
    </header>



    <!-- Main -->
    <main class="main">
      <!-- Left Panel: Controls -->
      <aside class="panel panel-left">
        <div class="panel-header">Controls</div>
        <div class="panel-content">

          <!-- Generate Mode -->
          <div id="generateControls" class="mode-controls">
            <div class="field">
              <div class="prompt-component">
                <div class="prompt-header">Prompt</div>
                <textarea class="textarea" id="genPrompt" placeholder="Describe the image..."></textarea>
              </div>
            </div>

            <div class="field">
              <label class="field-label">Batch Size</label>
              <div class="slider-wrap">
                <input type="range" class="slider" id="genBatchSize" min="1" max="4" step="1" value="1">
                <span class="slider-value" id="genBatchSizeValue">1</span>
              </div>
            </div>
            <div class="field">
              <label class="field-label">Width</label>
              <div class="slider-wrap">
                <input type="range" class="slider" id="genWidth" min="512" max="2048" step="128" value="1024">
                <span class="slider-value" id="genWidthValue">1024</span>
              </div>
            </div>
            <div class="field">
              <label class="field-label">Height</label>
              <div class="slider-wrap">
                <input type="range" class="slider" id="genHeight" min="512" max="2048" step="128" value="1024">
                <span class="slider-value" id="genHeightValue">1024</span>
              </div>
            </div>
            <div class="field field-guidance">
              <label class="field-label">Guidance</label>
              <div class="slider-wrap">
                <input type="range" class="slider" id="genGuidance" min="0" max="10" step="0.5" value="1">
                <span class="slider-value" id="genGuidanceValue">1.0</span>
              </div>
              <!-- Guidance Chip (Contextual Tooltip) -->
              <div id="canvasChip" class="guidance-chip hidden">
                <div class="chip-main">
                  <span class="chip-label">GUIDANCE:</span>
                  <span class="chip-value" id="chipValue">0.0</span>
                </div>
                <div id="chipDesc" class="chip-description"></div>
              </div>
            </div>
            <div class="field">
              <label class="field-label">Sampler</label>
              <div class="custom-select" id="genSampler" data-value="flow_euler">
                <div class="select-trigger">
                  <span class="select-current">Flow-Euler</span>
                  <svg class="select-chevron" width="10" height="10" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="3">
                    <path d="m6 9 6 6 6-6" />
                  </svg>
                </div>
                <div class="select-dropdown">
                  <div class="select-dropdown-inner">
                    <div class="select-option active" data-value="flow_euler">Flow-Euler</div>
                    <div class="select-option" data-value="euler">Euler</div>
                    <div class="select-option" data-value="euler_a">Euler Ancestral</div>
                    <div class="select-option" data-value="dpm++_2s_a">DPM++ 2S Ancestral</div>
                    <div class="select-option" data-value="dpm++_2m">DPM++ 2M</div>
                    <div class="select-option" data-value="dpm++_2m_karras">DPM++ 2M Karras</div>
                    <div class="select-option" data-value="ddim">DDIM</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="field">
              <label class="field-label">Scheduler</label>
              <div class="custom-select" id="genScheduler" data-value="standard">
                <div class="select-trigger">
                  <span class="select-current">Linear</span>
                  <svg class="select-chevron" width="10" height="10" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="3">
                    <path d="m6 9 6 6 6-6" />
                  </svg>
                </div>
                <div class="select-dropdown">
                  <div class="select-dropdown-inner">
                    <div class="select-option active" data-value="standard">Linear</div>
                    <div class="select-option" data-value="simple">Simple</div>
                    <div class="select-option" data-value="beta">Beta</div>
                    <div class="select-option" data-value="karras">Karras</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Decompose Mode -->
          <div id="decomposeControls" class="mode-controls hidden">
            <div class="field">
              <label class="field-label">Source Image</label>
              <div id="uploadZone" class="dropzone">
                <span class="dropzone-text">Drop image or click</span>
                <input type="file" id="imageInput" accept="image/*" hidden>
              </div>
            </div>
            <div class="field">
              <label class="field-label">Layers</label>
              <div class="slider-wrap">
                <input type="range" class="slider" id="layerCount" min="2" max="8" value="4">
                <span class="slider-value" id="layerCountValue">4</span>
              </div>
            </div>
          </div>

          <!-- Edit Mode -->
          <div id="editControls" class="mode-controls hidden">
            <div class="field">
              <label class="field-label">Mask Mode</label>
              <div class="toggle-group">
                <button class="toggle-btn active" data-mask="auto">Auto</button>
                <button class="toggle-btn" data-mask="manual">Manual</button>
              </div>
            </div>
            <div class="field">
              <label class="field-label">Canny Edges</label>
              <div class="toggle-group">
                <button class="toggle-btn active" data-canny="off">Off</button>
                <button class="toggle-btn" data-canny="on">On</button>
              </div>
            </div>
            <div id="brushControls" class="field hidden">
              <label class="field-label">Brush Size</label>
              <div class="slider-wrap">
                <input type="range" class="slider" id="brushSize" min="5" max="100" value="30">
                <span class="slider-value" id="brushSizeValue">30</span>
              </div>
              <button class="btn btn-block mt-sm" id="clearMaskBtn">Clear Mask</button>
            </div>
            <div class="field">
              <div class="prompt-component">
                <div class="prompt-header">Prompt</div>
                <textarea class="textarea" id="editPrompt" placeholder="Describe the edit..."></textarea>
              </div>
            </div>
            <div class="field">
              <label class="field-label">Strength</label>
              <div class="slider-wrap">
                <input type="range" class="slider" id="editStrength" min="0" max="100" value="75">
                <span class="slider-value" id="editStrengthValue">75%</span>
              </div>
            </div>
            <div class="field">
              <label class="field-label">Preprocessor</label>
              <div class="custom-select" id="editPreprocessor" data-value="none">
                <div class="select-trigger">
                  <span class="select-current">None</span>
                  <svg class="select-chevron" width="10" height="10" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="3">
                    <path d="m6 9 6 6 6-6" />
                  </svg>
                </div>
                <div class="select-dropdown">
                  <div class="select-dropdown-inner">
                    <div class="select-option active" data-value="none">None</div>
                    <div class="select-option" data-value="canny">Canny Edge</div>
                    <div class="select-option" data-value="blur">Gaussian Blur</div>
                    <div class="select-option" data-value="sharpen">Sharpen</div>
                    <div class="select-option" data-value="grayscale">Grayscale</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Stylize Mode -->
          <div id="stylizeControls" class="mode-controls hidden">
            <div class="field">
              <label class="field-label">Content Image</label>
              <div id="contentUploadZone" class="dropzone">
                <span class="dropzone-text">Drop content image</span>
                <input type="file" id="contentInput" accept="image/*" hidden>
              </div>
            </div>
            <div class="field">
              <label class="field-label">Style Reference</label>
              <div id="styleUploadZone" class="dropzone">
                <span class="dropzone-text">Drop style image</span>
                <input type="file" id="styleInput" accept="image/*" hidden>
              </div>
            </div>
            <div class="field">
              <div class="prompt-component">
                <div class="prompt-header">Prompt</div>
                <textarea class="textarea" id="stylizePrompt" placeholder="Blend instructions..."></textarea>
              </div>
            </div>
            <div class="field">
              <label class="field-label">Style Strength</label>
              <div class="slider-wrap">
                <input type="range" class="slider" id="styleStrength" min="0" max="100" value="70">
                <span class="slider-value" id="styleStrengthValue">70%</span>
              </div>
            </div>
            <div class="field">
              <label class="field-label">Content Preprocessor</label>
              <select class="select" id="stylizePreprocessor">
                <option value="none" selected>None</option>
                <option value="canny">Canny Edge</option>
                <option value="blur">Gaussian Blur</option>
                <option value="sharpen">Sharpen</option>
                <option value="grayscale">Grayscale</option>
              </select>
            </div>
          </div>

          <!-- Status -->
          <div id="statusBar" class="status mt-md hidden"></div>
        </div>

        <!-- Sticky Action Button -->
        <div class="panel-action">
          <button class="btn btn-primary btn-block" id="generateBtn">GENERATE</button>
          <button class="btn btn-primary btn-block hidden" id="stylizeBtn">STYLIZE</button>
          <button class="btn btn-primary btn-block hidden" id="decomposeBtn">DECOMPOSE</button>
          <button class="btn btn-primary btn-block hidden" id="editBtn">APPLY EDIT</button>
        </div>
      </aside>

      <!-- Canvas Area with Tabs inside -->
      <section class="canvas-area">
        <!-- Tabs at top of canvas -->
        <nav class="canvas-tabs">
          <button class="tab active" data-mode="generate">Generate</button>
          <button class="tab" data-mode="stylize">Stylize</button>
          <button class="tab" data-mode="decompose">Decompose</button>
          <button class="tab" data-mode="edit">Edit</button>
        </nav>
        <div id="canvasContainer" class="canvas-container">
          <div id="canvasStackWrapper" class="canvas-stack-wrapper"></div>
          <div class="comparison-handle" id="comparisonHandle" style="display: none;"></div>
          <div class="canvas-focus-controls hidden" id="focusControls">
            <button class="focus-btn" id="copyPromptBtn" title="Copy Prompt">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
            </button>
            <button class="focus-btn" id="expandCanvasBtn" title="Focus Mode">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"></path>
              </svg>
            </button>
          </div>
        </div>
      </section>

      <!-- Right Panel: Layers -->
      <aside class="panel panel-right">
        <div class="panel-header">Layers</div>
        <div class="panel-content">
          <div id="layerList">
            <div class="empty-state">EMPTY</div>
          </div>
          <div class="panel-buffer" style="height: 100px;"></div>
        </div>
      </aside>
    </main>
  </div>

  <script src="scripts/canvas-stack.js?v=2"></script>
  <script src="scripts/masking.js?v=2"></script>
  <script src="scripts/animations.js?v=2"></script>
  <script src="scripts/prompts.js?v=2"></script>
  <script src="scripts/viewport.js?v=2"></script>
  <script src="scripts/comparison.js?v=2"></script>

  <!-- Modular Architecture -->
  <script type="module" src="scripts/main.js"></script>
</body>

</html>